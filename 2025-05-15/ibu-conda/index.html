<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Conda - Parisod Lab Dry Guide</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/version-select.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Conda";
        var mkdocs_page_input_path = "ibu-conda.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Parisod Lab Dry Guide
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../intro/">Lab Introduction</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Data Management</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../data-organization/">Data Organization Guidelines</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../best_practices/">Folder Organization Best Practices</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ena/">Data Submission on ENA</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../public-data/">Public Data Repositories</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">IBU</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../ibu-intro/">How to access</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Conda</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#why_conda">Why Conda</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#setting_up_conda_on_ibu">Setting up Conda on IBU</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#using_conda">Using Conda</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#running_snakemake_with_conda">Running Snakemake with conda</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#notes_on_conda_versions_on_ibu">Notes on conda versions on IBU</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#a_faster_alternative_to_conda">A faster alternative to Conda</a>
    </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Coding Knowledge Base</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../vscode/">VScode</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../r/">R</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../bash/">Command Line</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../github/">Source Control with Git and VScode</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">snakeGATK sequencing workflow</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../pipeline-overview/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../pipeline-trimming/">Trim pipeline</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../pipeline-mapping/">Alignment pipeline</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Other things</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../labsite/">Parisod Labsite</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Parisod Lab Dry Guide</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">IBU</li>
      <li class="breadcrumb-item active">Conda</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/parisodlab/dry-guide/edit/master/docs/ibu-conda.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="using_conda_on_ibu">Using conda on IBU<a class="headerlink" href="#using_conda_on_ibu" title="Permanent link">&para;</a></h1>
<div class="toc">
<ul>
<li><a href="#using_conda_on_ibu">Using conda on IBU</a><ul>
<li><a href="#why_conda">Why Conda</a></li>
<li><a href="#setting_up_conda_on_ibu">Setting up Conda on IBU</a></li>
<li><a href="#using_conda">Using Conda</a></li>
<li><a href="#running_snakemake_with_conda">Running Snakemake with conda</a></li>
<li><a href="#notes_on_conda_versions_on_ibu">Notes on conda versions on IBU</a></li>
<li><a href="#a_faster_alternative_to_conda">A faster alternative to Conda</a></li>
</ul>
</li>
</ul>
</div>
<h2 id="why_conda">Why Conda<a class="headerlink" href="#why_conda" title="Permanent link">&para;</a></h2>
<p><strong>Computational Reproducibility</strong> ensures that an analysis can be exactly replicated. To achieve this in computational research, it is essential to track the code, software, and data used. Code is managed using git and GitHub (refer to the <a href="../github/">Github page</a> for assistance). Typically, the initial data (often FASTQs) remains unchanged, so tracking data changes is unnecessary. New analyses are conducted when additional data is introduced. Software, however, is updated frequently, and the same version of software may not be the latest in the future.</p>
<p>To track software, package and environment managers such as Conda and Singularity/Docker are very useful. </p>
<h2 id="setting_up_conda_on_ibu">Setting up Conda on IBU<a class="headerlink" href="#setting_up_conda_on_ibu" title="Permanent link">&para;</a></h2>
<p>Anaconda is a Python distribution that contains many packages including conda. Miniconda is a more compact version of Anaconda that also includes conda. So in order to install conda, we usually either install Miniconda or Anaconda. On IBU, Anaconda is already installed. However there are many versions of Anaconda, each can have a different version of Python and Conda. The current environments at IBU is available using <code>module load Anaconda3/2022.05</code> (See <strong>Notes</strong> below for more info) You can check the availability in future using the command <code>module avail |&amp; grep -i conda</code>.   </p>
<p>In your home directory <code>~/</code>, create a file called <code>.condarc</code> and put the following lines into it. It sets the channel priority when conda searches for packages. If possible, in one environment it is good to use packages from the same channel. </p>
<pre><code>channels:
  - conda-forge
  - bioconda
  - defaults

auto_activate_base: false

envs_dirs:
  - ~/.conda/envs/
  - /data/users/&lt;user_id&gt;/conda_envs/
</code></pre>
<h2 id="using_conda">Using Conda<a class="headerlink" href="#using_conda" title="Permanent link">&para;</a></h2>
<p><strong><a href="https://docs.conda.io/projects/conda/en/latest/user-guide/index.html">Conda Documentation</a></strong></p>
<p><strong><a href="https://docs.conda.io/projects/conda/en/4.6.0/_downloads/52a95608c49671267e40c689e0bc00ca/conda-cheatsheet.pdf">Conda Cheatsheet</a></strong></p>
<p>After loading the Anaconda module, one can create an environment and install packages into that environment:</p>
<pre><code># Create conda environment named &quot;name_of_env&quot;
conda create --name name_of_env

# Create conda environment in a specific folder
conda create -p /data/users/&lt;user_id&gt;/conda_envs/test

# activate conda environment
# for some `conda activate` works and for others `source activate`
conda activate test
source activate test

# install package into conda environment
conda install bcftools
</code></pre>
<p>When looking to install a package, one resource to check out is <a href="https://anaconda.org">anaconda.org</a>, search for your package and run the install command listed on the page.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Remember to keep in mind the different versions of software/packages. You could have bcftools-v1.10 or bcftools-v.1.12, so make sure you install the correct one!</p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>You can also install R packages with conda, however conda and R don't always work well together. Check out our quick fix <a href="../r/">here</a></p>
</div>
<h2 id="running_snakemake_with_conda">Running Snakemake with conda<a class="headerlink" href="#running_snakemake_with_conda" title="Permanent link">&para;</a></h2>
<p>When running Snakemake, Conda environments should be stored in a subfolder <code>workflow/envs</code> (make sure to keep them as finegrained as possible to improve transparency and maintainability) (check out the <a href="https://snakemake.readthedocs.io/en/stable/snakefiles/deployment.html#integrated-package-management">documentation</a>):</p>
<p><strong>Conda within a rule:</strong></p>
<pre><code>rule NAME:
    input:
        &quot;table.txt&quot;
    output:
        &quot;plots/myplot.pdf&quot;
    conda:
        &quot;envs/ggplot.yaml&quot;
    script:
        &quot;scripts/plot-stuff.R&quot;
</code></pre>
<p><strong>Conda environment <code>snake_env.yaml</code> for the entire workflow: (with snakemake for execution working great in 2024)</strong></p>
<pre><code>name: snake_env
channels:
    - conda-forge
    - bioconda
    - defaults
    - R
dependencies:
    - r-base=4.3.2
    - snakemake=8.16.0
    - snakemake-minimal=8.16.0
    - snakemake-wrapper-utils=0.1.3
    - pigz=2.3.4
    - toposort=1.10
    - python&gt;=3.10
    - pip=23.1.2
# bioconda channel installs
    - fastqc
    - trimmomatic=0.36
    - multiqc
    - qualimap
    - pip:
        - snakemake-executor-plugin-cluster-generic
</code></pre>
<h2 id="notes_on_conda_versions_on_ibu">Notes on conda versions on IBU<a class="headerlink" href="#notes_on_conda_versions_on_ibu" title="Permanent link">&para;</a></h2>
<p>As of 2024, conda environments generated with <code>module load anaconda3/2022.05</code> from IBU loads Python version 3.9.12 and conda 4.12.0. </p>
<p>Once you activate an environment with <code>conda activate env_name</code> or <code>source activate env_name</code>, the default conda usually get re-directed to the conda that were originally used to create the environment. This is good because it helps ensure that all packages in the same environment uses the same version of conda. One can go to <code>cd ~/.conda/env_name/bin</code> and <code>readlink -f conda</code> or <code>readlink -f activate</code> to see which version of conda is used by this environment. This is exactly how Snakemake determines which conda to use when using an existing conda environment. </p>
<h2 id="a_faster_alternative_to_conda">A faster alternative to Conda<a class="headerlink" href="#a_faster_alternative_to_conda" title="Permanent link">&para;</a></h2>
<p>In recent years, a 'drop-in' replacement for Conda, called Mamba, was released. Mamba is faster at resolving dependencies, which improves wait times for creating and activating environments. Conda and Mamba seem to be forward and backwards compatible, and they share the same command structure. For example, <code>conda create</code> and <code>mamba create</code> do the same task and share the same parameters.</p>
<p>If you prefer to use Mamba, you can install it in your home directory by running these commands:</p>
<pre><code>cd ~
wget https://github.com/conda-forge/miniforge/releases/latest/download/Mambaforge-Linux-x86_64.sh
chmod +x ./Mambaforge-Linux-x86_64.sh
./Mambaforge-Linux-x86_64.sh
</code></pre>
<p>After completing the installation, the <code>mamba</code> binary should be added to <code>$PATH</code>, and you should be able to create, configure, and activate environments using the same commands as <code>conda</code> (FYI the <code>conda</code> binary will still be available to be called from <code>$PATH</code> by default). </p>
<p>You will immediately notice a difference in speed when using mamba. Test it by loading an environment:</p>
<pre><code>mamba activate /data/users/&lt;user_id&gt;/conda_envs/&lt;env_name&gt;
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../ibu-intro/" class="btn btn-neutral float-left" title="How to access"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../vscode/" class="btn btn-neutral float-right" title="VScode">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/parisodlab/dry-guide" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../ibu-intro/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../vscode/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
      <script src="../js/version-select.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
